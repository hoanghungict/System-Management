# Docker Commands for WSL - System Management Project
# CÃ¡c lá»‡nh Docker cáº§n thiáº¿t cho dá»± Ã¡n System Management trÃªn WSL

## ğŸ³ DOCKER CONTAINER MANAGEMENT

### Khá»Ÿi Ä‘á»™ng táº¥t cáº£ containers
```bash
docker-compose up -d
```

### Khá»Ÿi Ä‘á»™ng container cá»¥ thá»ƒ
```bash
docker-compose up -d app
docker-compose up -d webserver
docker-compose up -d db
docker-compose up -d redis
docker-compose up -d queue
```

### Táº¯t táº¥t cáº£ containers (GIá»® DATABASE)
```bash
docker-compose down
```

### Táº¯t vÃ  xÃ³a volumes (Máº¤T DATABASE - Cáº¨N THáº¬N!)
```bash
docker-compose down -v
```

âš ï¸ **QUAN TRá»ŒNG**: 
- `docker-compose down` - Chá»‰ táº¯t containers, **GIá»®** database
- `docker-compose down -v` - Táº¯t containers vÃ  **XÃ“A** database (máº¥t data!)

### Restart container
```bash
docker-compose restart app
docker-compose restart webserver
docker-compose restart db
docker-compose restart redis
docker-compose restart queue
```

### Xem tráº¡ng thÃ¡i containers
```bash
docker-compose ps
```

### Xem logs
```bash
docker-compose logs -f
docker-compose logs -f app
docker-compose logs -f webserver
docker-compose logs -f db
docker-compose logs -f redis
docker-compose logs -f queue
```

## ğŸ—„ï¸ DATABASE MANAGEMENT

### VÃ o MySQL container
```bash
docker-compose exec db mysql -u system_services -phpc123 system_services
```

### Backup database
```bash
docker-compose exec db mysqldump -u system_services -phpc123 system_services > backup_$(date +%Y%m%d_%H%M%S).sql
```

### Restore database
```bash
docker-compose exec -T db mysql -u system_services -phpc123 system_services < backup_file.sql
```

### Xem database
```bash
docker-compose exec db mysql -u system_services -phpc123 -e "SHOW DATABASES;"
```

### Xem tables
```bash
docker-compose exec db mysql -u system_services -phpc123 -e "USE system_services; SHOW TABLES;"
```

## ğŸš€ LARAVEL APPLICATION MANAGEMENT

### VÃ o PHP container
```bash
docker-compose exec app bash
```

### Clear Laravel cache
```bash
docker-compose exec app php artisan cache:clear
docker-compose exec app php artisan config:clear
docker-compose exec app php artisan route:clear
docker-compose exec app php artisan view:clear
```

### Clear táº¥t cáº£ cache
```bash
docker-compose exec app php artisan optimize:clear
```

### Cháº¡y migrations
```bash
docker-compose exec app php artisan migrate
docker-compose exec app php artisan migrate:fresh
docker-compose exec app php artisan migrate:fresh --seed
```

### Cháº¡y seeders
```bash
docker-compose exec app php artisan db:seed
```

### Generate key
```bash
docker-compose exec app php artisan key:generate
```

### Install dependencies
```bash
docker-compose exec app composer install
docker-compose exec app composer update
```

## ğŸ”§ REDIS MANAGEMENT

### VÃ o Redis container
```bash
docker-compose exec redis redis-cli
```

### Xem Redis keys
```bash
docker-compose exec redis redis-cli keys "*"
```

### Clear Redis cache
```bash
docker-compose exec redis redis-cli flushall
docker-compose exec redis redis-cli flushdb
```

### Monitor Redis
```bash
docker-compose exec redis redis-cli monitor
```

## ğŸ“ FILE MANAGEMENT

### Copy files vÃ o container
```bash
docker cp local_file.txt container_name:/path/to/destination
```

### Copy files tá»« container
```bash
docker cp container_name:/path/to/file.txt ./local_file.txt
```

### Xem file permissions
```bash
docker-compose exec php-fpm ls -la
```

### Fix permissions
```bash
docker-compose exec app chown -R www-data:www-data storage bootstrap/cache
docker-compose exec app chmod -R 775 storage bootstrap/cache
```

### âœ… Tá»° Äá»˜NG FIX PERMISSIONS (ÄÃƒ Cáº¤U HÃŒNH)
**KhÃ´ng cáº§n cháº¡y thá»§ cÃ´ng ná»¯a!** Há»‡ thá»‘ng Ä‘Ã£ Ä‘Æ°á»£c cáº¥u hÃ¬nh tá»± Ä‘á»™ng fix permissions má»—i khi container khá»Ÿi Ä‘á»™ng.

**CÃ¡ch hoáº¡t Ä‘á»™ng:**
- `docker/entrypoint.sh` - Script tá»± Ä‘á»™ng cháº¡y má»—i khi container start
- Tá»± Ä‘á»™ng táº¡o cÃ¡c thÆ° má»¥c cáº§n thiáº¿t trong storage/
- Tá»± Ä‘á»™ng set ownership vÃ  permissions cho www-data

**Náº¿u váº«n gáº·p lá»—i, rebuild image:**
```bash
docker-compose build --no-cache app
docker-compose up -d
```

## ğŸ” DEBUGGING & MONITORING

### Xem resource usage
```bash
docker stats
```

### Xem container details
```bash
docker inspect container_name
```

### Xem network
```bash
docker network ls
docker network inspect system-management_default
```

### Xem volumes
```bash
docker volume ls
docker volume inspect system-management_mysql_data
```

## ğŸ§¹ CLEANUP COMMANDS

### XÃ³a containers Ä‘Ã£ táº¯t
```bash
docker container prune
```

### XÃ³a images khÃ´ng dÃ¹ng
```bash
docker image prune
```

### XÃ³a volumes khÃ´ng dÃ¹ng
```bash
docker volume prune
```

### XÃ³a networks khÃ´ng dÃ¹ng
```bash
docker network prune
```

### XÃ³a táº¥t cáº£ (cáº©n tháº­n!)
```bash
docker system prune -a
```

## ğŸš¨ DATABASE RECOVERY

### Kiá»ƒm tra volumes
```bash
docker volume ls
docker volume inspect system-management_db_data
```

### Backup database trÆ°á»›c khi táº¯t
```bash
docker-compose exec db mysqldump -u system_services -phpc123 system_services > backup_before_shutdown.sql
```

### Restore database sau khi máº¥t
```bash
docker-compose exec -T db mysql -u system_services -phpc123 system_services < backup_before_shutdown.sql
```

### Táº¡o volume má»›i náº¿u bá»‹ máº¥t
```bash
# Táº¡o volume má»›i
docker volume create system-management_db_data

# Restore tá»« backup
docker-compose exec -T db mysql -u system_services -phpc123 system_services < backup_file.sql
```

### Kiá»ƒm tra database cÃ³ tá»“n táº¡i khÃ´ng
```bash
docker-compose exec db mysql -u system_services -phpc123 -e "SHOW DATABASES;"
```

## ğŸš¨ EMERGENCY COMMANDS

### Force stop container
```bash
docker-compose kill
```

### Force remove container
```bash
docker-compose rm -f
```

### Rebuild containers
```bash
docker-compose build --no-cache
docker-compose up -d --force-recreate
```

### Reset everything
```bash
docker-compose down -v --remove-orphans
docker-compose build --no-cache
docker-compose up -d
```

## ğŸ“‹ QUICK REFERENCE

### Daily workflow
```bash
# Start project
docker-compose up -d

# Check status
docker-compose ps

# View logs
docker-compose logs -f

# Clear cache
docker-compose exec php-fpm php artisan optimize:clear

# Stop project
docker-compose down
```

### Development workflow
```bash
# Start with fresh database
docker-compose down -v
docker-compose up -d
docker-compose exec php-fpm php artisan migrate:fresh --seed

# Clear cache after changes
docker-compose exec php-fpm php artisan optimize:clear

# Check logs for errors
docker-compose logs -f php-fpm
```

### Production deployment
```bash
# Update code
git pull

# Install dependencies
docker-compose exec php-fpm composer install --no-dev --optimize-autoloader

# Run migrations
docker-compose exec php-fpm php artisan migrate --force

# Clear cache
docker-compose exec php-fpm php artisan optimize:clear
docker-compose exec php-fpm php artisan config:cache
docker-compose exec php-fpm php artisan route:cache
docker-compose exec php-fpm php artisan view:cache

# Restart services
docker-compose restart php-fpm nginx
```

## ğŸ” SECURITY COMMANDS

### Change MySQL root password
```bash
docker-compose exec mysql mysql -u root -p -e "ALTER USER 'root'@'localhost' IDENTIFIED BY 'new_password';"
```

### Create new MySQL user
```bash
docker-compose exec mysql mysql -u root -p -e "CREATE USER 'new_user'@'%' IDENTIFIED BY 'password'; GRANT ALL PRIVILEGES ON system_management.* TO 'new_user'@'%'; FLUSH PRIVILEGES;"
```

### Backup with encryption
```bash
docker-compose exec mysql mysqldump -u root -p system_management | gzip > backup_$(date +%Y%m%d_%H%M%S).sql.gz
```

## ğŸ“Š MONITORING COMMANDS

### Health check
```bash
docker-compose exec php-fpm php artisan health:check
```

### Queue status
```bash
docker-compose exec php-fpm php artisan queue:work --once
```

### Schedule status
```bash
docker-compose exec php-fpm php artisan schedule:list
```

### Storage link
```bash
docker-compose exec php-fpm php artisan storage:link
```

## ğŸ¯ TROUBLESHOOTING

### Container won't start
```bash
# Check logs
docker-compose logs container_name

# Check status
docker-compose ps

# Restart specific service
docker-compose restart service_name
```

### Permission issues
```bash
# Fix ownership
docker-compose exec php-fpm chown -R www-data:www-data .

# Fix permissions
docker-compose exec php-fpm chmod -R 755 .
docker-compose exec php-fpm chmod -R 775 storage bootstrap/cache
```

### Database connection issues
```bash
# Check MySQL status
docker-compose exec mysql mysqladmin -u root -p status

# Test connection
docker-compose exec php-fpm php artisan tinker
# Then run: DB::connection()->getPdo();
```

### Redis connection issues
```bash
# Test Redis connection
docker-compose exec redis redis-cli ping

# Check Redis config
docker-compose exec redis redis-cli config get "*"
```

## ğŸ“ NOTES

- Thay `container_name` báº±ng tÃªn container thá»±c táº¿
- Thay `service_name` báº±ng tÃªn service trong docker-compose.yml
- LuÃ´n backup database trÆ°á»›c khi cháº¡y migrations
- Sá»­ dá»¥ng `-d` flag Ä‘á»ƒ cháº¡y containers á»Ÿ background
- Sá»­ dá»¥ng `-f` flag Ä‘á»ƒ follow logs real-time
- Sá»­ dá»¥ng `--no-cache` khi rebuild Ä‘á»ƒ Ä‘áº£m báº£o clean build
